
ALTER SESSION SET NLS_DATE_FORMAT = 'DD/MM/YYYY';
ALTER SESSION SET NLS_LANGUAGE = 'BRAZILIAN PORTUGUESE';
ALTER SESSION SET NLS_TERRITORY = 'BRAZIL';
ALTER SESSION SET NLS_NUMERIC_CHARACTERS = ',.';
SET LINESIZE 500
SET PAGESIZE 500

COLUMN TABLESPACE_NAME FORMAT A30
COLUMN FILE_NAME FORMAT A80
COLUMN MAX_SIZE_MB FORMAT 999G999D99
COLUMN SIZE_MB FORMAT 999G999D99
COLUMN MAX_FREE_MB FORMAT 999G999D99

SELECT TABLESPACE_NAME, 
TO_CHAR(MAX_SIZE_MB,'999G999G999D99') MAX_SIZE_MB,
TO_CHAR(SIZE_MB,'999G999G999D99') SIZE_MB,
TO_CHAR(MAX_FREE_MB,'999G999G999D99') MAX_FREE_MB,
TRUNC((MAX_FREE_MB/MAX_SIZE_MB) * 100) AS FREE_PCT
FROM (SELECT A.TABLESPACE_NAME,  B.MAX_SIZE_MB, B.SIZE_MB, 
A.FREE_MB + (B.MAX_SIZE_MB - B.SIZE_MB) AS MAX_FREE_MB
FROM (SELECT TABLESPACE_NAME,
TRUNC(SUM(BYTES)/1024/1024) AS FREE_MB
FROM   DBA_FREE_SPACE
GROUP BY TABLESPACE_NAME) A,
(SELECT TABLESPACE_NAME,
TRUNC(SUM(BYTES)/1024/1024) AS SIZE_MB,
TRUNC(SUM(GREATEST(BYTES,MAXBYTES))/1024/1024) AS MAX_SIZE_MB
FROM   DBA_DATA_FILES
GROUP BY TABLESPACE_NAME) B
WHERE  A.TABLESPACE_NAME = B.TABLESPACE_NAME)
ORDER BY SIZE_MB DESC;
  

COLUMN FILE_ID FORMAT 999
COLUMN TABLESPACE_NAME FORMAT A30
COLUMN FILE_NAME FORMAT A80
COLUMN MAXSIZE_MB FORMAT 999G999D99
COLUMN SIZE_MB FORMAT 999G999D99
COLUMN FREE_MB FORMAT 999G999D99

SELECT DF.TABLESPACE_NAME, DF.FILE_ID, DF.FILE_NAME, 
TO_CHAR(DF.MAXBYTES/1024/1024,'999G999G999D99') "MAXSIZE_MB",
TO_CHAR(DF.BYTES/1024/1024,'999G999D99') "SIZE_MB",
TO_CHAR((DF.MAXBYTES - DF.BYTES)/1024/1024,'999G999G999D99') "FREE_MB"
FROM DBA_DATA_FILES DF
INNER JOIN DBA_TABLESPACES TB ON DF.TABLESPACE_NAME = TB.TABLESPACE_NAME
ORDER BY DF.TABLESPACE_NAME, DF.FILE_NAME;


